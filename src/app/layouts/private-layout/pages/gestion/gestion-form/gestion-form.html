<div class="w-full">
  <form [formGroup]="gestionForm" (ngSubmit)="onSubmit()" class="space-y-8">
    <!-- Sección: Información Titular -->
    <div>
      <h3 class="text-xl font-semibold text-[#243B88] mb-6">Información Titular</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="relative mb-5">
          <label class="block text-sm font-medium text-gray-700 ">Tipo Documento</label>
          <select formControlName="tipoDocumento" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#7EA6F4]">
            @for (td of tiposDocumento; track td.id) {
              <option [value]="td.id">{{ td.name }}</option>
            }
          </select>
          <div class="absolute left-0 top-full h-5 pointer-events-none ">
            @if (isInvalid('tipoDocumento')) {
              <span class="text-xs text-red-600">{{ getError('tipoDocumento') }}</span>
            }
          </div>
        </div>
        <div class="relative mb-5">
          <label class="block text-sm font-medium text-gray-700 ">Número de Documento</label>
          <input type="text" formControlName="numeroDocumento" maxlength="10" inputmode="numeric" (input)="onNumericInput($event, 'numeroDocumento', 10)" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#7EA6F4]" />
          <div class="absolute left-0 top-full h-5 pointer-events-none">
            @if (isInvalid('numeroDocumento')) {
              <span class="text-xs text-red-600">{{ getError('numeroDocumento') }}</span>
            }
          </div>
        </div>
        <div class="relative mb-5" [ngClass]="{'md:col-span-2': isNitSelected}">
          <label class="block text-sm font-medium text-gray-700 ">{{ isNitSelected ? 'Nombre o Razón Social' : 'Nombre' }}</label>
          <input type="text" formControlName="nombre" placeholder="Campo se llena automáticamente" [disabled]="true" class="w-full px-3 py-2 border rounded-md bg-gray-100 text-gray-500 placeholder:text-gray-400 cursor-not-allowed" />
          <div class="absolute left-0 top-full h-5 pointer-events-none">
            @if (isInvalid('nombre')) {
              <span class="text-xs text-red-600">{{ getError('nombre') }}</span>
            }
          </div>
        </div>
        @if (!isNitSelected) {
          <div class="relative mb-5">
            <label class="block text-sm font-medium text-gray-700 ">Apellido</label>
            <input type="text" formControlName="apellido" placeholder="Campo se llena automáticamente" [disabled]="true" class="w-full px-3 py-2 border rounded-md bg-gray-100 text-gray-500 placeholder:text-gray-400 cursor-not-allowed" />
            <div class="absolute left-0 top-full h-5 pointer-events-none">
              @if (isInvalid('apellido')) {
                <span class="text-xs text-red-600">{{ getError('apellido') }}</span>
              }
            </div>
          </div>
        }
      </div>
    </div>

    <!-- Separador sutil entre secciones -->
    <div class="h-px bg-gray-200/60"></div>

    <!-- Sección: Información Póliza -->
    <div>
      <h3 class="text-xl font-semibold text-[#243B88] mb-6">Información Póliza</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="relative mb-5">
          <label class="block text-sm font-medium text-gray-700 ">Número de Póliza</label>
          <input type="text" formControlName="numeroPoliza" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#7EA6F4]" />
          <div class="absolute left-0 top-full h-5 pointer-events-none">
            @if (isInvalid('numeroPoliza')) {
              <span class="text-xs text-red-600">{{ getError('numeroPoliza') }}</span>
            }
          </div>
        </div>
        <div class="relative mb-5">
          <label class="block text-sm font-medium text-gray-700 ">Tipo de Póliza</label>
          <input type="text" formControlName="tipoPoliza" (input)="onCapitalizeInput($event, 'tipoPoliza')" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#7EA6F4]" />
          <div class="absolute left-0 top-full h-5 pointer-events-none">
            @if (isInvalid('tipoPoliza')) {
              <span class="text-xs text-red-600">{{ getError('tipoPoliza') }}</span>
            }
          </div>
        </div>
        <div class="relative mb-5">
          <label class="block text-sm font-medium text-gray-700 ">Forma de Pago</label>
          <select formControlName="formaPagoRenovacion" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#7EA6F4]">
            @for (fp of formaPago; track fp) {
              <option [value]="fp">{{ fp }}</option>
            }
          </select>
          <div class="absolute left-0 top-full h-5 pointer-events-none">
            @if (isInvalid('formaPagoRenovacion')) {
              <span class="text-xs text-red-600">{{ getError('formaPagoRenovacion') }}</span>
            }
          </div>
        </div>
        <div class="relative mb-5">
          <label class="block text-sm font-medium text-gray-700 ">Valor Póliza Año Anterior</label>
          <input type="text" formControlName="valorAnterior" inputmode="numeric" (input)="onNumericInput($event, 'valorAnterior')" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#7EA6F4]" />
          <div class="absolute left-0 top-full h-5 pointer-events-none">
            @if (isInvalid('valorAnterior')) {
              <span class="text-xs text-red-600">{{ getError('valorAnterior') }}</span>
            }
          </div>
        </div>
        <div class="relative mb-5">
          <label class="block text-sm font-medium text-gray-700">Valor Póliza Año Actual</label>
          <input type="text" formControlName="valorActual" inputmode="numeric" (input)="onNumericInput($event, 'valorActual')" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#7EA6F4]" />
          <div class="absolute left-0 top-full h-5 pointer-events-none">
            @if (isInvalid('valorActual')) {
              <span class="text-xs text-red-600">{{ getError('valorActual') }}</span>
            }
          </div>
        </div>
        <div class="relative mb-5">
          <label class="block text-sm font-medium text-gray-700 ">Fecha de Vencimiento</label>
          <input type="date" formControlName="fechaVencimiento" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#7EA6F4]" />
          <div class="absolute left-0 top-full h-5 pointer-events-none">
            @if (isInvalid('fechaVencimiento')) {
              <span class="text-xs text-red-600">{{ getError('fechaVencimiento') }}</span>
            }
          </div>
        </div>
        <div class="relative mb-5">
          <label class="block text-sm font-medium text-gray-700">Aseguradora</label>
          <input type="text" formControlName="aseguradora" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#7EA6F4]" />
          <div class="absolute left-0 top-full h-5 pointer-events-none">
            @if (isInvalid('aseguradora')) {
              <span class="text-xs text-red-600">{{ getError('aseguradora') }}</span>
            }
          </div>
        </div>
        <!-- Es Vehículo toggle al lado de Aseguradora -->
        <div class="relative mb-5">
          <label class="block text-sm font-medium text-gray-700 mb-2">¿Esta póliza es para un vehículo?</label>
          <label class="inline-flex items-center gap-3 select-none cursor-pointer">
            <input type="checkbox" formControlName="esVehiculo" class="peer sr-only" />
            <span class="inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200 bg-gray-300 peer-checked:bg-[#243B88] p-0.5 justify-start peer-checked:justify-end">
              <span class="h-5 w-5 rounded-full bg-white shadow"></span>
            </span>
          </label>
        </div>
        <!-- Prenda y Placa visibles solo si es Vehículo -->
        @if (gestionForm.get('esVehiculo')?.value) {
          <div class="relative mb-5">
            <label class="block text-sm font-medium text-gray-700">Placa</label>
            <input type="text" formControlName="placa" (input)="onUppercaseInput($event, 'placa')" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#7EA6F4] uppercase" />
            <div class="absolute left-0 top-full h-5 pointer-events-none">
              @if (isInvalid('placa')) {
                <span class="text-xs text-red-600">La Placa es Obligatoria</span>
              }
            </div>
          </div>
          <div class="relative mb-5">
            <label class="block text-sm font-medium text-gray-700">Prenda</label>
            <label class="inline-flex items-center gap-3 select-none cursor-pointer">
              <input type="checkbox" formControlName="prenda" class="peer sr-only" />
              <span class="inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200 bg-gray-300 peer-checked:bg-[#243B88] p-0.5 justify-start peer-checked:justify-end">
                <span class="h-5 w-5 rounded-full bg-white shadow"></span>
              </span>
            </label>
            <p class="mt-1 text-xs text-gray-500">Si el vehículo tiene prenda, active este campo.</p>
          </div>
          @if (gestionForm.get('prenda')?.value) {
            <div class="relative mb-5">
              <label class="block text-sm font-medium text-gray-700">Entidad Prendaria</label>
              <input type="text" formControlName="entidadPrendaria" (input)="onCapitalizeInput($event, 'entidadPrendaria')" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#7EA6F4]" />
              <div class="absolute left-0 top-full h-5 pointer-events-none">
                @if (isInvalid('entidadPrendaria')) {
                  <span class="text-xs text-red-600">La Entidad prendaria es obligatoria</span>
                }
              </div>
            </div>
          }
        }
      </div>
    </div>

    <div class="mt-6 flex items-center justify-end gap-3">
      <button type="button" (click)="onCancel()" class="px-4 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50">Cancelar</button>
      <button type="submit" [disabled]="isSubmitting" class="px-4 py-2 rounded-md bg-[#243B88] text-white disabled:opacity-70 disabled:cursor-not-allowed">
        <span class="inline-flex items-center gap-2">
          @if (isSubmitting) {
            <svg xmlns="http://www.w3.org/2000/svg" class="animate-spin h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <circle cx="12" cy="12" r="10" stroke-width="4" class="opacity-25" />
              <path d="M4 12a8 8 0 018-8" stroke-width="4" class="opacity-75" />
            </svg>
          }
          <span>{{ isSubmitting ? 'Guardando...' : 'Guardar' }}</span>
        </span>
      </button>
    </div>
  </form>
</div>
